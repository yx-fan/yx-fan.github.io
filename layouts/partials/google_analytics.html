<!-- Google Analytics tracking code -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-4KY4X96MYQ"></script>
<script>
   window.dataLayer = window.dataLayer || [];
   function gtag(){dataLayer.push(arguments);}
   gtag('js', new Date());

   // Enhanced GA4 configuration with custom parameters
   gtag('config', 'G-4KY4X96MYQ', {
     // Page type classification
     page_type: '{{ if .IsHome }}homepage{{ else if eq .Section "projects" }}projects{{ else if eq .Section "about" }}about{{ else if eq .Section "tags" }}tags{{ else if eq .Section "log" }}log{{ else }}content{{ end }}',
     // Content category
     content_category: '{{ .Section | default "general" }}',
     // Custom dimensions
     custom_map: {
       'dimension1': 'page_type',
       'dimension2': 'content_category'
     }
   });
</script>

<script>
// Enhanced event tracking utilities
(function() {
  'use strict';
  
  // Track project card clicks
  document.addEventListener('DOMContentLoaded', function() {
    // Track project card clicks
    const projectCards = document.querySelectorAll('.project-card a[href]');
    projectCards.forEach(function(card) {
      card.addEventListener('click', function(e) {
        const projectTitle = this.closest('.project-card')?.querySelector('h2 a')?.textContent || 'Unknown';
        if (typeof gtag !== 'undefined') {
          gtag('event', 'project_click', {
            'event_category': 'engagement',
            'event_label': projectTitle,
            'value': 1
          });
        }
      });
    });
    
    // Track tag clicks
    const tagItems = document.querySelectorAll('.tag-item');
    tagItems.forEach(function(tag) {
      tag.addEventListener('click', function(e) {
        const tagName = this.querySelector('.tag-name')?.textContent || 'Unknown';
        if (typeof gtag !== 'undefined') {
          gtag('event', 'tag_click', {
            'event_category': 'navigation',
            'event_label': tagName,
            'value': 1
          });
        }
      });
    });
    
    // Track external link clicks (LinkedIn, etc.)
    const externalLinks = document.querySelectorAll('a[href^="http"]:not([href*="' + window.location.hostname + '"])');
    externalLinks.forEach(function(link) {
      link.addEventListener('click', function(e) {
        const linkUrl = this.href;
        const linkText = this.textContent.trim() || linkUrl;
        if (typeof gtag !== 'undefined') {
          gtag('event', 'external_link_click', {
            'event_category': 'outbound',
            'event_label': linkText,
            'transport_type': 'beacon',
            'event_callback': function() {
              // Allow navigation to proceed
            }
          });
        }
      });
    });
    
    // Track tag search usage
    const tagSearchInput = document.getElementById('tagSearch');
    if (tagSearchInput) {
      let searchTimeout;
      tagSearchInput.addEventListener('input', function(e) {
        clearTimeout(searchTimeout);
        const searchTerm = e.target.value.trim();
        if (searchTerm.length > 2) {
          searchTimeout = setTimeout(function() {
            if (typeof gtag !== 'undefined') {
              gtag('event', 'tag_search', {
                'event_category': 'search',
                'search_term': searchTerm,
                'value': 1
              });
            }
          }, 1000); // Track after 1 second of typing
        }
      });
    }
    
    // Track scroll depth (25%, 50%, 75%, 100%)
    let scrollDepthTracked = {
      25: false,
      50: false,
      75: false,
      100: false
    };
    
    function trackScrollDepth() {
      const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
      const docHeight = document.documentElement.scrollHeight - document.documentElement.clientHeight;
      const scrollPercent = Math.round((scrollTop / docHeight) * 100);
      
      [25, 50, 75, 100].forEach(function(threshold) {
        if (scrollPercent >= threshold && !scrollDepthTracked[threshold]) {
          scrollDepthTracked[threshold] = true;
          if (typeof gtag !== 'undefined') {
            gtag('event', 'scroll_depth', {
              'event_category': 'engagement',
              'event_label': threshold + '%',
              'value': threshold
            });
          }
        }
      });
    }
    
    // Throttle scroll tracking
    let scrollTimeout;
    window.addEventListener('scroll', function() {
      if (scrollTimeout) {
        window.cancelAnimationFrame(scrollTimeout);
      }
      scrollTimeout = window.requestAnimationFrame(trackScrollDepth);
    });
    
    // Track time on page (after 30 seconds)
    let timeOnPageTracked = false;
    setTimeout(function() {
      if (!timeOnPageTracked) {
        timeOnPageTracked = true;
        if (typeof gtag !== 'undefined') {
          gtag('event', 'time_on_page', {
            'event_category': 'engagement',
            'event_label': '30_seconds',
            'value': 30
          });
        }
      }
    }, 30000);
    
    // Track log entry clicks (on log list page)
    const logEntries = document.querySelectorAll('.log-entry a[href]');
    logEntries.forEach(function(entry) {
      entry.addEventListener('click', function(e) {
        const logTitle = this.textContent.trim() || 'Unknown';
        if (typeof gtag !== 'undefined') {
          gtag('event', 'log_entry_click', {
            'event_category': 'engagement',
            'event_label': logTitle,
            'value': 1
          });
        }
      });
    });
    
    // Track ticker card clicks (on homepage)
    const tickerCards = document.querySelectorAll('.ticker-card a[href]');
    tickerCards.forEach(function(card) {
      card.addEventListener('click', function(e) {
        const tickerTitle = this.querySelector('.ticker-title')?.textContent?.trim() || 'Unknown';
        if (typeof gtag !== 'undefined') {
          gtag('event', 'ticker_card_click', {
            'event_category': 'engagement',
            'event_label': tickerTitle,
            'value': 1
          });
        }
      });
    });
    
    // Track ticker drag interactions (on homepage)
    const tickerTrack = document.getElementById('tickerTrack');
    if (tickerTrack) {
      let dragStartTime = null;
      let dragDistance = 0;
      let lastX = 0;
      
      tickerTrack.addEventListener('mousedown', function(e) {
        dragStartTime = Date.now();
        lastX = e.pageX;
        dragDistance = 0;
      });
      
      document.addEventListener('mousemove', function(e) {
        if (dragStartTime !== null) {
          dragDistance += Math.abs(e.pageX - lastX);
          lastX = e.pageX;
        }
      });
      
      document.addEventListener('mouseup', function() {
        if (dragStartTime !== null && dragDistance > 50) {
          const dragDuration = Date.now() - dragStartTime;
          if (typeof gtag !== 'undefined') {
            gtag('event', 'ticker_drag', {
              'event_category': 'interaction',
              'event_label': 'ticker_scroll',
              'value': Math.round(dragDistance / 100), // Distance in "units"
              'custom_parameter': {
                'duration_ms': dragDuration
              }
            });
          }
        }
        dragStartTime = null;
        dragDistance = 0;
      });
    }
    
    // Track "View All Log" link clicks
    const viewAllLogLink = document.querySelector('.ticker-view-all');
    if (viewAllLogLink) {
      viewAllLogLink.addEventListener('click', function(e) {
        if (typeof gtag !== 'undefined') {
          gtag('event', 'view_all_log_click', {
            'event_category': 'navigation',
            'event_label': 'homepage_to_log',
            'value': 1
          });
        }
      });
    }
  });
})();
</script>