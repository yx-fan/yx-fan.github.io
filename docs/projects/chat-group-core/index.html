<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>Group Chat Architecture and Implementation | Yuxin Fan</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="description" content="An in-depth exploration of the architecture and implementation of a group chat system, covering group creation, subscription, real-time messaging, and gRPC-based communication between microservices.">
    <meta name="generator" content="Hugo 0.143.0">
    
    
    
    
      <meta name="robots" content="noindex, nofollow">
    
    

    
<link rel="stylesheet" href="/ananke/css/main.min.css" >



    
    
    <link rel="stylesheet" href="https://yx-fan.github.io/css/shared.css">
    
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    <script>
      
      const firebaseConfig = {
        apiKey: "AIzaSyDkOKW_GzV0dBjgGLYE6ASMYB1WLLrjD4M",
        authDomain: "yx-fan-website.firebaseapp.com",
        databaseURL: "https://yx-fan-website-default-rtdb.firebaseio.com",
        projectId: "yx-fan-website",
        storageBucket: "yx-fan-website.firebasestorage.app",
        messagingSenderId: "76941092208",
        appId: "1:76941092208:web:8cd643195ef05a6dd09bb5",
        measurementId: "G-XDZ9H5W5QX"
      };
      
      
      firebase.initializeApp(firebaseConfig);
    </script>
    
    
<script async src="https://www.googletagmanager.com/gtag/js?id=G-4KY4X96MYQ"></script>
<script>
   window.dataLayer = window.dataLayer || [];
   function gtag(){dataLayer.push(arguments);}
   gtag('js', new Date());

   
   gtag('config', 'G-4KY4X96MYQ', {
     
     page_type: 'projects',
     
     content_category: 'projects',
     
     custom_map: {
       'dimension1': 'page_type',
       'dimension2': 'content_category'
     }
   });
</script>

<script>

(function() {
  'use strict';
  
  
  document.addEventListener('DOMContentLoaded', function() {
    
    const projectCards = document.querySelectorAll('.project-card a[href]');
    projectCards.forEach(function(card) {
      card.addEventListener('click', function(e) {
        const projectTitle = this.closest('.project-card')?.querySelector('h2 a')?.textContent || 'Unknown';
        if (typeof gtag !== 'undefined') {
          gtag('event', 'project_click', {
            'event_category': 'engagement',
            'event_label': projectTitle,
            'value': 1
          });
        }
      });
    });
    
    
    const tagItems = document.querySelectorAll('.tag-item');
    tagItems.forEach(function(tag) {
      tag.addEventListener('click', function(e) {
        const tagName = this.querySelector('.tag-name')?.textContent || 'Unknown';
        if (typeof gtag !== 'undefined') {
          gtag('event', 'tag_click', {
            'event_category': 'navigation',
            'event_label': tagName,
            'value': 1
          });
        }
      });
    });
    
    
    const externalLinks = document.querySelectorAll('a[href^="http"]:not([href*="' + window.location.hostname + '"])');
    externalLinks.forEach(function(link) {
      link.addEventListener('click', function(e) {
        const linkUrl = this.href;
        const linkText = this.textContent.trim() || linkUrl;
        if (typeof gtag !== 'undefined') {
          gtag('event', 'external_link_click', {
            'event_category': 'outbound',
            'event_label': linkText,
            'transport_type': 'beacon',
            'event_callback': function() {
              
            }
          });
        }
      });
    });
    
    
    const tagSearchInput = document.getElementById('tagSearch');
    if (tagSearchInput) {
      let searchTimeout;
      tagSearchInput.addEventListener('input', function(e) {
        clearTimeout(searchTimeout);
        const searchTerm = e.target.value.trim();
        if (searchTerm.length > 2) {
          searchTimeout = setTimeout(function() {
            if (typeof gtag !== 'undefined') {
              gtag('event', 'tag_search', {
                'event_category': 'search',
                'search_term': searchTerm,
                'value': 1
              });
            }
          }, 1000); 
        }
      });
    }
    
    
    let scrollDepthTracked = {
      25: false,
      50: false,
      75: false,
      100: false
    };
    
    function trackScrollDepth() {
      const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
      const docHeight = document.documentElement.scrollHeight - document.documentElement.clientHeight;
      const scrollPercent = Math.round((scrollTop / docHeight) * 100);
      
      [25, 50, 75, 100].forEach(function(threshold) {
        if (scrollPercent >= threshold && !scrollDepthTracked[threshold]) {
          scrollDepthTracked[threshold] = true;
          if (typeof gtag !== 'undefined') {
            gtag('event', 'scroll_depth', {
              'event_category': 'engagement',
              'event_label': threshold + '%',
              'value': threshold
            });
          }
        }
      });
    }
    
    
    let scrollTimeout;
    window.addEventListener('scroll', function() {
      if (scrollTimeout) {
        window.cancelAnimationFrame(scrollTimeout);
      }
      scrollTimeout = window.requestAnimationFrame(trackScrollDepth);
    });
    
    
    let timeOnPageTracked = false;
    setTimeout(function() {
      if (!timeOnPageTracked) {
        timeOnPageTracked = true;
        if (typeof gtag !== 'undefined') {
          gtag('event', 'time_on_page', {
            'event_category': 'engagement',
            'event_label': '30_seconds',
            'value': 30
          });
        }
      }
    }, 30000);
    
    
    const logEntries = document.querySelectorAll('.log-entry a[href]');
    logEntries.forEach(function(entry) {
      entry.addEventListener('click', function(e) {
        const logTitle = this.textContent.trim() || 'Unknown';
        if (typeof gtag !== 'undefined') {
          gtag('event', 'log_entry_click', {
            'event_category': 'engagement',
            'event_label': logTitle,
            'value': 1
          });
        }
      });
    });
    
    
    const tickerCards = document.querySelectorAll('.ticker-card a[href]');
    tickerCards.forEach(function(card) {
      card.addEventListener('click', function(e) {
        const tickerTitle = this.querySelector('.ticker-title')?.textContent?.trim() || 'Unknown';
        if (typeof gtag !== 'undefined') {
          gtag('event', 'ticker_card_click', {
            'event_category': 'engagement',
            'event_label': tickerTitle,
            'value': 1
          });
        }
      });
    });
    
    
    const tickerTrack = document.getElementById('tickerTrack');
    if (tickerTrack) {
      let dragStartTime = null;
      let dragDistance = 0;
      let lastX = 0;
      
      tickerTrack.addEventListener('mousedown', function(e) {
        dragStartTime = Date.now();
        lastX = e.pageX;
        dragDistance = 0;
      });
      
      document.addEventListener('mousemove', function(e) {
        if (dragStartTime !== null) {
          dragDistance += Math.abs(e.pageX - lastX);
          lastX = e.pageX;
        }
      });
      
      document.addEventListener('mouseup', function() {
        if (dragStartTime !== null && dragDistance > 50) {
          const dragDuration = Date.now() - dragStartTime;
          if (typeof gtag !== 'undefined') {
            gtag('event', 'ticker_drag', {
              'event_category': 'interaction',
              'event_label': 'ticker_scroll',
              'value': Math.round(dragDistance / 100), 
              'custom_parameter': {
                'duration_ms': dragDuration
              }
            });
          }
        }
        dragStartTime = null;
        dragDistance = 0;
      });
    }
    
    
    const viewAllLogLink = document.querySelector('.ticker-view-all');
    if (viewAllLogLink) {
      viewAllLogLink.addEventListener('click', function(e) {
        if (typeof gtag !== 'undefined') {
          gtag('event', 'view_all_log_click', {
            'event_category': 'navigation',
            'event_label': 'homepage_to_log',
            'value': 1
          });
        }
      });
    }
  });
})();
</script>

    
      

    

    

    
      <link rel="canonical" href="https://yx-fan.github.io/projects/chat-group-core/">
    

    <meta property="og:url" content="https://yx-fan.github.io/projects/chat-group-core/">
  <meta property="og:site_name" content="Yuxin Fan">
  <meta property="og:title" content="Group Chat Architecture and Implementation">
  <meta property="og:description" content="An in-depth exploration of the architecture and implementation of a group chat system, covering group creation, subscription, real-time messaging, and gRPC-based communication between microservices.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="projects">
    <meta property="article:published_time" content="2024-10-20T00:00:00+00:00">
    <meta property="article:modified_time" content="2024-10-20T00:00:00+00:00">
    <meta property="article:tag" content="Chat">
    <meta property="article:tag" content="System Design">
    <meta property="article:tag" content="Real-Time Messaging">
    <meta property="article:tag" content="Node.js">
    <meta property="article:tag" content="MongoDB">
    <meta property="article:tag" content="Message Queue">

  <meta itemprop="name" content="Group Chat Architecture and Implementation">
  <meta itemprop="description" content="An in-depth exploration of the architecture and implementation of a group chat system, covering group creation, subscription, real-time messaging, and gRPC-based communication between microservices.">
  <meta itemprop="datePublished" content="2024-10-20T00:00:00+00:00">
  <meta itemprop="dateModified" content="2024-10-20T00:00:00+00:00">
  <meta itemprop="wordCount" content="1122">
  <meta itemprop="keywords" content="Chat,System Design,Real-Time Messaging,Node.js,MongoDB,Message Queue,Web Socket,Web3,GRPC">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Group Chat Architecture and Implementation">
  <meta name="twitter:description" content="An in-depth exploration of the architecture and implementation of a group chat system, covering group creation, subscription, real-time messaging, and gRPC-based communication between microservices.">

	
  </head>

  <body class="ma0 avenir bg-near-white">

    
   
  

  <header>
    <div class="bg-black">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="/" class="f3 fw2 hover-white no-underline white-90 dib">
      
        Yuxin Fan
      
    </a>
    <div class="flex-l items-center">
      

      
        <ul class="pl0 mr3">
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="/" title="Home page">
              Home
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="/about/" title="About Me page">
              About Me
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="/log/" title="Log page">
              Log
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="/projects/" title="Projects page">
              Projects
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="/tags/" title="Tags page">
              Tags
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="https://www.linkedin.com/in/fanyuxin/" title="Resume page">
              Resume
            </a>
          </li>
          
        </ul>
      
      
<div class="ananke-socials">
  
</div>

      
<div class="like-button-compact-container" id="likeContainerCompact">
  <button class="like-button-compact" id="likeButtonCompact" aria-label="Like this page">
    <span class="like-icon-compact">❤️</span>
    <span class="like-count-compact" id="likeCountCompact">0</span>
  </button>
  <div class="like-particles-compact" id="likeParticlesCompact"></div>
</div>

<style>
.like-button-compact-container {
  position: relative;
  display: inline-flex;
  align-items: center;
  margin-left: 1rem;
}

.like-button-compact {
  position: relative;
  display: inline-flex;
  align-items: center;
  gap: 0.4rem;
  padding: 0.4rem 0.75rem;
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 20px;
  color: white;
  font-size: 0.875rem;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.3s ease;
  backdrop-filter: blur(10px);
  user-select: none;
  -webkit-tap-highlight-color: transparent;
}

.like-button-compact:hover {
  background: rgba(255, 255, 255, 0.15);
  border-color: rgba(255, 255, 255, 0.3);
  transform: translateY(-1px);
}

.like-button-compact:active {
  transform: translateY(0) scale(0.95);
}

.like-button-compact.clicked {
  background: rgba(255, 107, 157, 0.2);
  border-color: rgba(255, 107, 157, 0.4);
}

.like-icon-compact {
  font-size: 1rem;
  transition: transform 0.3s ease;
  display: inline-block;
}

.like-button-compact.clicked .like-icon-compact {
  animation: heartBeatCompact 0.6s ease-in-out;
}

@keyframes heartBeatCompact {
  0%, 100% { transform: scale(1); }
  25% { transform: scale(1.3) rotate(-5deg); }
  50% { transform: scale(1.2) rotate(5deg); }
  75% { transform: scale(1.3) rotate(-3deg); }
}

.like-count-compact {
  font-size: 0.875rem;
  font-weight: 600;
  min-width: 1.5rem;
  text-align: center;
}

.like-particles-compact {
  position: absolute;
  top: 50%;
  left: 50%;
  pointer-events: none;
  z-index: 0;
}

.particle-compact {
  position: absolute;
  width: 4px;
  height: 4px;
  background: #ff6b9d;
  border-radius: 50%;
  pointer-events: none;
  animation: particleFloatCompact 1.5s ease-out forwards;
  box-shadow: 0 0 4px rgba(255, 107, 157, 0.8);
}

.particle-compact:nth-child(odd) {
  background: #ffd93d;
  box-shadow: 0 0 4px rgba(255, 217, 61, 0.8);
}

.particle-compact:nth-child(3n) {
  background: #6bcf7f;
  box-shadow: 0 0 4px rgba(107, 207, 127, 0.8);
}

@keyframes particleFloatCompact {
  0% {
    opacity: 1;
    transform: translate(-50%, -50%) scale(1) rotate(0deg);
  }
  50% {
    opacity: 0.8;
  }
  100% {
    opacity: 0;
    transform: translate(-50%, -50%) translateY(-80px) translateX(calc(var(--random-x) * 1px)) scale(0) rotate(720deg);
  }
}

@media (max-width: 768px) {
  .like-button-compact {
    padding: 0.4rem 0.75rem;
    font-size: 0.75rem;
  }
  
  .like-icon-compact {
    font-size: 0.875rem;
  }
  
  .like-count-compact {
    font-size: 0.75rem;
  }
}
</style>

<script>
(function() {
  'use strict';
  
  const likeButton = document.getElementById('likeButtonCompact');
  const likeCount = document.getElementById('likeCountCompact');
  const likeParticles = document.getElementById('likeParticlesCompact');
  
  if (typeof firebase === 'undefined') {
    console.error('Firebase is not loaded');
    return;
  }
  
  const database = firebase.database();
  const likesRef = database.ref('likes/homepage');
  let currentCount = 0;
  let isUpdating = false;
  let skipListenerUpdate = false;
  
  const RATE_LIMIT_MS = 1000;
  const LAST_CLICK_KEY = 'lastLikeClickCompact';
  
  function canClick() {
    const lastClick = localStorage.getItem(LAST_CLICK_KEY);
    if (!lastClick) return true;
    const timeSinceLastClick = Date.now() - parseInt(lastClick, 10);
    return timeSinceLastClick >= RATE_LIMIT_MS;
  }
  
  function recordClick() {
    localStorage.setItem(LAST_CLICK_KEY, Date.now().toString());
  }
  
  likesRef.once('value', (snapshot) => {
    const count = snapshot.val();
    currentCount = count || 0;
    likeCount.textContent = currentCount.toLocaleString();
  }, (error) => {
    console.error('Error loading likes:', error);
    likeCount.textContent = '0';
  });
  
  likesRef.on('value', (snapshot) => {
    if (skipListenerUpdate) {
      return;
    }
    const count = snapshot.val();
    if (count !== null && count !== undefined) {
      currentCount = count;
      likeCount.textContent = currentCount.toLocaleString();
    }
  }, (error) => {
    console.error('Error listening to likes:', error);
  });
  
  function createParticles(count = 10) {
    for (let i = 0; i < count; i++) {
      const particle = document.createElement('div');
      particle.className = 'particle-compact';
      
      const angle = (Math.PI * 2 * i) / count;
      const distance = 15 + Math.random() * 15;
      const x = Math.cos(angle) * distance;
      const y = Math.sin(angle) * distance;
      const randomX = (Math.random() - 0.5) * 60;
      
      particle.style.left = `calc(50% + ${x}px)`;
      particle.style.top = `calc(50% + ${y}px)`;
      particle.style.animationDelay = `${Math.random() * 0.2}s`;
      particle.style.setProperty('--random-x', randomX);
      
      likeParticles.appendChild(particle);
      
      setTimeout(() => {
        particle.remove();
      }, 1500);
    }
  }
  
  likeButton.addEventListener('click', function(e) {
    e.preventDefault();
    
    if (isUpdating) {
      return;
    }
    
    isUpdating = true;
    skipListenerUpdate = true;
    
    this.classList.add('clicked');
    
    if (!canClick()) {
      return;
    }
    
    recordClick();
    
    likesRef.once('value', (snapshot) => {
      const currentValue = snapshot.val() || 0;
      const newValue = currentValue + 1;
      
      likesRef.set(newValue)
        .then(() => {
          currentCount = newValue;
          likeCount.textContent = newValue.toLocaleString();
          
          setTimeout(() => {
            skipListenerUpdate = false;
          }, 100);
          
          createParticles(10);
          
          if (typeof gtag !== 'undefined') {
            gtag('event', 'page_like', {
              'event_category': 'engagement',
              'event_label': 'homepage',
              'value': newValue,
              'like_count': newValue,
              'non_interaction': false
            });
          } else if (typeof window.dataLayer !== 'undefined') {
            window.dataLayer.push({
              'event': 'page_like',
              'event_category': 'engagement',
              'event_label': 'homepage',
              'value': newValue,
              'like_count': newValue
            });
          }
          
          setTimeout(() => {
            this.classList.remove('clicked');
            isUpdating = false;
          }, 600);
        })
        .catch((error) => {
          console.error('Error updating likes:', error);
          isUpdating = false;
          skipListenerUpdate = false;
          this.classList.remove('clicked');
        });
    }, (error) => {
      console.error('Error reading current value:', error);
      isUpdating = false;
      skipListenerUpdate = false;
      this.classList.remove('clicked');
    });
  });
})();
</script>


    </div>
  </div>
</nav>

    </div>
  </header>



    <main class="pb7" role="main">
      
  
  <article class="flex-l flex-wrap justify-between mw8 center ph3">
    <header class="mt4 w-100">
      <aside class="instapaper_ignoref b helvetica tracked ttu">
          
        My Projects
      </aside>
      







  



  







  <div id="sharing" class="mt3 ananke-socials">
    
  </div>



      <h1 class="f1 athelas mt3 mb1">Group Chat Architecture and Implementation</h1>
      
      
      
      <time class="f6 mv4 dib tracked" datetime="2024-10-20T00:00:00Z">October 20, 2024</time>
      

      
      
    </header>
    <div class="nested-copy-line-height lh-copy serif f4 nested-links mid-gray pr4-l w-two-thirds-l"><p>In this article, I’ll walk through the architecture and implementation details of a <strong>Group Chat System</strong>. This system allows users to create groups, send and receive messages in real-time, and ensures message delivery even when users are offline. The architecture leverages <strong>message queues</strong> and <strong>gRPC-based microservices</strong> for efficient, reliable communication between the backend services, ensuring seamless interactions. Below, I’ll explore both the group creation process and the messaging flow using detailed sequence charts to illustrate each step.</p>
<hr>
<h2 id="1-group-creation-and-subscription">1. Group Creation and Subscription</h2>
<p>This section explores how users create groups and subscribe to receive group messages. The flow covers creating a group, notifying group members, and managing online and offline statuses for group message delivery.</p>
<h3 id="sequence-flow">Sequence Flow</h3>
<p>Here’s the step-by-step sequence for creating a group and subscribing members:</p>
<ol>
<li>
<p><strong>Group Creation via API</strong><br>
User A sends a POST request to create a group. This request is processed by the backend, which stores group details in the database. The user&rsquo;s JWT token is verified before creating the group. A dedicated function is used to handle group creation notifications to ensure group members are informed.</p>
</li>
<li>
<p><strong>notify_create_group Event</strong><br>
Once the group is successfully created via the API, the <strong>notify_create_group</strong> event is sent from the client to the backend. This event signals the backend to notify the relevant group members that the group has been created. A backend function processes this request and sends an <strong>a_group_created</strong> message to the relevant group members directly via their WebSocket connection.</p>
<ul>
<li><strong>Direct Message Sending</strong>: The backend sends notifications directly to the front-ends of the group members via WebSockets, bypassing the message queue system.</li>
</ul>
</li>
<li>
<p><strong>Member Subscription</strong><br>
After receiving the notification, each group member subscribes to the group topic using the <strong>subscribe_to_group</strong> event. This event is processed by a function designed to ensure that the member is successfully subscribed to the group&rsquo;s messages.</p>
</li>
<li>
<p><strong>Handling Offline Members</strong><br>
If a member is offline during group creation, the notification is stored, and they will receive it upon reconnection. The system ensures that group members are subscribed as soon as they reconnect.</p>
</li>
</ol>
<hr>
<h2 id="2-group-chat-for-text-messages">2. Group Chat for Text Messages</h2>
<p>Once a group is created and members are subscribed, the system enables real-time messaging between group members. The flow includes sending, receiving, and acknowledging group messages, and handling offline members.</p>
<h3 id="sequence-flow-1">Sequence Flow</h3>
<ol>
<li>
<p><strong>User Authentication</strong><br>
Users authenticate via JWT tokens to establish a secure WebSocket connection. A function is responsible for handling the connection, verifying user credentials, and connecting them to the group chat system.</p>
</li>
<li>
<p><strong>send_group_message Event</strong><br>
Users send messages to the group via the <strong>send_group_message</strong> event. A backend function validates, encrypts, and stores the message in the database. After saving the message, the system uses a message queue to publish it to the group topic.</p>
</li>
<li>
<p><strong>Message Delivery</strong><br>
Once the message is published to the group topic, it is delivered to all online group members in real-time. For offline users, the message is stored for delivery when they reconnect. Each group member acknowledges receiving the message using the <strong>acknowledge_group_message</strong> event.</p>
<ul>
<li><strong>acknowledge_group_message Event</strong>: After receiving a message, each member sends an acknowledgment back to the server. A backend function processes these acknowledgments, updating the message&rsquo;s status to &ldquo;read.&rdquo;</li>
</ul>
</li>
<li>
<p><strong>Error Handling and Rollback</strong><br>
If an error occurs during the message-sending process, the system emits an error event to the sender. If the message has been stored but not fully processed, a rollback mechanism is used to revert any changes to the message status in the database.</p>
</li>
</ol>
<hr>
<h2 id="3-group-chat-for-non-text-messages-media">3. Group Chat for Non-Text Messages (Media)</h2>
<p>For sending media (such as images or videos) in a group chat, the process involves uploading files to cloud storage before sending the message.</p>
<h3 id="sequence-flow-2">Sequence Flow</h3>
<ol>
<li>
<p><strong>Request Pre-signed URL</strong><br>
Users request a pre-signed URL for media uploads from the backend. This request is processed by a backend function that generates an upload URL for AWS S3 and returns it to the user.</p>
</li>
<li>
<p><strong>Upload Media to Cloud</strong><br>
Users upload media files to AWS S3 using the pre-signed URL. Once the upload is complete, they send the media URL to the group via the <strong>send_group_message</strong> event. The media URL is treated like other message content and stored in the database.</p>
</li>
<li>
<p><strong>Media Message Delivery</strong><br>
After the media message is sent and stored, it is delivered to the group members in real-time. Online members receive the media URL immediately, while offline members will receive it when they reconnect.</p>
</li>
<li>
<p><strong>Handling Errors</strong><br>
If an error occurs during the media upload or message sending process, an error event is emitted to the user, and the message status is rolled back if necessary.</p>
</li>
</ol>
<hr>
<h2 id="4-data-model-design">4. Data Model Design</h2>
<p>The system&rsquo;s data model is designed to store information about groups, messages, and their statuses efficiently. Here’s a breakdown of the key models used:</p>
<ol>
<li>
<p><strong>Group Model</strong></p>
<ul>
<li>The <strong>Group</strong> model defines the structure of a chat group, including its name, description, members, and metadata (such as who created the group and when). Each group can have multiple members, and member information is stored with a reference to a <code>UserProfile</code>. A group also tracks who the current owner is, allowing for ownership transfers.</li>
<li><strong>Members</strong>: The list of members is stored as an array within the group schema. Each member contains the user ID (referencing the <code>UserProfile</code>) and a <code>joinedAt</code> timestamp, indicating when the member joined the group.</li>
</ul>
</li>
<li>
<p><strong>GroupMessage Model</strong></p>
<ul>
<li>The <strong>GroupMessage</strong> model stores individual messages sent within a group. Each message is associated with a group and a sender (both referencing the respective <code>Group</code> and <code>UserProfile</code> models). Messages can either be text-based or media-based, with fields for both text content and media URLs.</li>
<li><strong>Types of Messages</strong>: The message type is defined with an enum that supports &rsquo;text&rsquo;, &lsquo;image&rsquo;, &lsquo;video&rsquo;, and &lsquo;audio&rsquo;. The model also tracks when the message was created and last updated.</li>
</ul>
</li>
<li>
<p><strong>GroupMessageStatus Model</strong></p>
<ul>
<li>The <strong>GroupMessageStatus</strong> model is designed to track the delivery and read statuses of messages for each group member. This allows the system to know which users have received and read each message. It references both the <code>GroupMessage</code> and <code>UserProfile</code> models to associate status updates with specific messages and users.</li>
<li><strong>Delivered and Read Flags</strong>: The model includes <code>delivered</code> and <code>read</code> boolean flags to track whether a message has been delivered and/or read by the user. The <code>updatedAt</code> field allows the system to keep track of when these statuses were last modified.</li>
</ul>
</li>
</ol>
<hr>
<h2 id="conclusion">Conclusion</h2>
<p>This architecture outlines how group chat works for both text and media messages in a real-time, secure environment. By leveraging <strong>WebSocket connections</strong>, <strong>gRPC-based microservices</strong>, and <strong>message queues</strong>, the system efficiently handles message delivery and ensures reliability for both online and offline users. The sequence charts illustrate the key WebSocket events like <strong>notify_create_group</strong>, <strong>send_group_message</strong>, <strong>subscribe_to_group</strong>, and <strong>acknowledge_group_message</strong>, which form the backbone of the group chat&rsquo;s functionality. The data model design ensures that group information, messages, and statuses are stored efficiently, providing the necessary structure to support real-time communication.</p>
<ul class="pa0">
  
   <li class="list di">
     <a href="/tags/chat/" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">Chat</a>
   </li>
  
   <li class="list di">
     <a href="/tags/system-design/" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">System Design</a>
   </li>
  
   <li class="list di">
     <a href="/tags/real-time-messaging/" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">Real-Time Messaging</a>
   </li>
  
   <li class="list di">
     <a href="/tags/node.js/" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">Node.js</a>
   </li>
  
   <li class="list di">
     <a href="/tags/mongodb/" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">MongoDB</a>
   </li>
  
   <li class="list di">
     <a href="/tags/message-queue/" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">Message Queue</a>
   </li>
  
   <li class="list di">
     <a href="/tags/web-socket/" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">Web Socket</a>
   </li>
  
   <li class="list di">
     <a href="/tags/web3/" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">Web3</a>
   </li>
  
   <li class="list di">
     <a href="/tags/grpc/" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">GRPC</a>
   </li>
  
</ul>
<div class="mt6 instapaper_ignoref">
      
      
      </div>
    </div>

    <aside class="w-30-l mt6-l">




  <div class="bg-light-gray pa3 nested-list-reset nested-copy-line-height nested-links">
    <p class="f5 b mb3">Related</p>
    <ul class="pa0 list">
	   
	     <li  class="mb2">
          <a href="/projects/chat-one-to-one-core/">One-to-One Chat Architecture and Implementation</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/projects/chat-platform-system-design-core-project/">CoolChat Platform System Design: Scalable and Secure Chat Architecture</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/projects/travel-expense-tracker-backend-system-core/">Travel Expense Tracker Backend System</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/projects/msg-queue-microservice-project/">Message Queue Microservice: Building a Scalable gRPC and RabbitMQ-Based Solution</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/projects/web3-auth-core-project/">Web3 Wallet Authentication System: A Decentralized Approach</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/projects/push-notification-microservice-project/">Push Notification Microservice: Scalable Multi-Platform Notification System</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/projects/mongodb-infra-project/">MongoDB Cluster Setup: Automated Deployment for High Availability and Scalability</a>
        </li>
	    
    </ul>
</div>

</aside>

  </article>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="https://yx-fan.github.io/" >
    &copy;  Yuxin Fan 2025 
  </a>
    <div>
<div class="ananke-socials">
  
</div>
</div>
  </div>
</footer>

  </body>
</html>

